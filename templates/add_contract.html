{% extends "base.html" %}
{% block body_block %}
{% load static %}
<link href="{% static 'css/add_contract.css' %}" rel="stylesheet">
   <script src="{% static 'js/add_contract.js' %}" defer></script>
<div class="container mt-4">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2 class="mb-0">Tạo hợp đồng dịch vụ</h2>
        </div>
    </div>

    <!-- Main Form Card -->
    <div class="form-card">
        <form method="POST" enctype="multipart/form-data" class="contract-form">
            {% csrf_token %}

            <!-- THÔNG TIN HỢP ĐỒNG -->
            <div class="form-section">
                <div class="section-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <h5>Thông tin hợp đồng</h5>
                </div>
                <div class="form-content">
                    <!-- Thêm ô tìm kiếm khách hàng -->
                    <div class="customer-search-wrapper">
                        <label for="customer_search">Tìm kiếm khách hàng</label>
                        <div class="search-input-group">
                            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text"
                                   id="customer_search"
                                   class="customer-search-input"
                                   placeholder="Nhập mã khách hàng hoặc tên để tìm kiếm..."
                                   autocomplete="off">
                        </div>
                        <div id="search_results" class="search-results"></div>
                        <div id="selected_customer" class="selected-customer"></div>
                    </div>

                    {{ contract_form.as_p }}
                </div>
            </div>

            <!-- THÔNG TIN DỊCH VỤ -->
            <div class="form-section">
                <div class="section-headesr">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                    <h5>Thông tin dịch vụ</h5>
                </div>

                <!-- Nhãn hiệu -->
             <div id="nhanhieu_form" class="service-block">
    <div class="service-header">
        <h6>Dịch vụ Nhãn hiệu</h6>
        <button type="button" class="btn-add" onclick="addForm('trademark')">
            ➕ Thêm nhãn hiệu
        </button>
    </div>

    {{ trademark_formset.management_form }}

    <div class="service-content" id="trademark-formset">
        {% for form in trademark_formset %}
        <div class="formset-item">
            {{ form.as_p }}
            {{ form.DELETE }}
            <button type="button" class="btn-remove" onclick="removeItem(this)">
                ❌ Xóa
            </button>
        </div>
        {% endfor %}
    </div>

    <div id="trademark-empty-form" style="display:none">
    <div class="formset-item">
        {{ trademark_formset.empty_form.as_p }}
        {{ trademark_formset.empty_form.DELETE }}
        <button type="button" class="btn-remove" onclick="removeItem(this)">
            ❌ Xóa
        </button>
    </div>
</div>


</div>


                <!-- Bản quyền -->
              <div id="banquyen_form" class="service-block">
    <div class="service-header">
        <h6>Dịch vụ Bản quyền</h6>
        <button type="button" class="btn-add" onclick="addForm('copyright')">
            ➕ Thêm bản quyền
        </button>
    </div>

    {{ copyright_formset.management_form }}

    <div class="service-content" id="copyright-formset">
        {% for form in copyright_formset %}
        <div class="formset-item">
            {{ form.as_p }}
            {{ form.DELETE }}
            <button type="button" class="btn-remove" onclick="removeItem(this)">
                ❌ Xóa
            </button>
        </div>
        {% endfor %}
    </div>

 <div id="copyright-empty-form" style="display:none">
    <div class="formset-item">
        {{ copyright_formset.empty_form.as_p }}
        {{ copyright_formset.empty_form.DELETE }}
        <button type="button" class="btn-remove" onclick="removeItem(this)">
            ❌ Xóa
        </button>
    </div>
</div>

</div>


                <!-- ĐKKD -->
                <div id="dkkd_form" class="service-block">
                    <div class="service-header">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <h6>Đăng ký kinh doanh</h6>
                    </div>
                    <div class="service-content">
                        {{ business_form.as_p }}
                    </div>
                </div>

                <!-- Đầu tư -->
                <div id="dautu_form" class="service-block">
                    <div class="service-header">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        <h6>Đầu tư</h6>
                    </div>
                    <div class="service-content">
                        {{ investment_form.as_p }}
                    </div>
                </div>

                <!-- Khác -->
                <div id="khac_form" class="service-block">
                    <div class="service-header">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <h6>Dịch vụ khác</h6>
                    </div>
                    <div class="service-content">
                        {{ other_form.as_p }}
                    </div>
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="form-actions">
                <button type="submit" class="btn-save">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Lưu hợp đồng
                </button>
                <a href="{% url 'home' %}" class="btn-cancel">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Hủy
                </a>
            </div>

        </form>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>






{% endblock %}