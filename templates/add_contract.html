{% extends 'base.html' %}
{% block body_block %}
  {% load static %}
  <link href="{% static 'css/add_contract.css' %}" rel="stylesheet" />

  <div class="container mt-4">
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        <h2 class="mb-0">T·∫°o h·ª£p ƒë·ªìng d·ªãch v·ª•</h2>
      </div>
    </div>

    <!-- Main Form Card -->
    <div class="form-card">
      <form method="POST" enctype="multipart/form-data" class="contract-form">
        {% csrf_token %}

        <!-- TH√îNG TIN H·ª¢P ƒê·ªíNG -->
        <div class="form-section">
          <div class="section-header">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <h5>Th√¥ng tin h·ª£p ƒë·ªìng</h5>
          </div>
          <div class="form-content">
            <!-- T√¨m ki·∫øm kh√°ch h√†ng -->
            <div class="customer-search-wrapper">
              <label for="customer_search">T√¨m ki·∫øm kh√°ch h√†ng</label>
              <div class="search-input-group">
                <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="customer_search" class="customer-search-input" placeholder="Nh·∫≠p m√£ kh√°ch h√†ng ho·∫∑c t√™n ƒë·ªÉ t√¨m ki·∫øm..." autocomplete="off" />
              </div>
              <div id="search_results" class="search-results"></div>
              <div id="selected_customer" class="selected-customer"></div>
            </div>

            {{ contract_form.as_p }}

            <!-- Tr∆∞·ªùng ng√†y thanh to√°n (ch·ªâ hi·ªán khi ch·ªçn tr·∫£ d·ª©t ƒëi·ªÉm) -->
           <!-- Th√¥ng tin thanh to√°n -->
<div class="card mt-3">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">üí∞ Th√¥ng tin thanh to√°n</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Gi√° tr·ªã h·ª£p ƒë·ªìng -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Gi√° tr·ªã h·ª£p ƒë·ªìng <span class="text-danger">*</span></label>
                {{ contract_form.contract_value }}
            </div>

            <!-- H√¨nh th·ª©c thanh to√°n -->
            <div class="col-md-6 mb-3">
                <label class="form-label">H√¨nh th·ª©c thanh to√°n <span class="text-danger">*</span></label>
                {{ contract_form.payment_type }}
            </div>

            <!-- S·ªë ti·ªÅn tr·∫£ tr∆∞·ªõc -->
            <div class="col-md-6 mb-3">
                <label class="form-label">S·ªë ti·ªÅn tr·∫£ tr∆∞·ªõc (VNƒê)</label>
                {{ contract_form.prepaid_amount }}
                <small class="form-text text-muted">ƒê·ªÉ tr·ªëng n·∫øu ch∆∞a tr·∫£ tr∆∞·ªõc</small>
            </div>
        </div>

        <!-- üÜï PH·∫¶N TR·∫¢ G√ìP (·∫®N M·∫∂C ƒê·ªäNH) -->
        <div id="installment-section" style="display: none;">
            <hr>
            <h6 class="text-primary mb-3">‚öôÔ∏è C·∫•u h√¨nh tr·∫£ g√≥p</h6>
            <div class="row">
                <!-- S·ªë ƒë·ª£t tr·∫£ g√≥p -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">S·ªë ƒë·ª£t tr·∫£ g√≥p</label>
                    {{ contract_form.number_of_installments }}
                    <small class="form-text text-muted">V√≠ d·ª•: 3, 6, 12 ƒë·ª£t...</small>
                </div>

                <!-- Kho·∫£ng c√°ch gi·ªØa c√°c ƒë·ª£t -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Kho·∫£ng c√°ch gi·ªØa c√°c ƒë·ª£t (ng√†y)</label>
                    {{ contract_form.installment_interval_days }}
                    <small class="form-text text-muted">30 ng√†y = 1 th√°ng, 90 ng√†y = 3 th√°ng...</small>
                </div>
            </div>

            <!-- Preview c√°c ƒë·ª£t -->
            <div id="installment-preview" class="alert alert-info" style="display: none;">
                <h6>üìã Xem tr∆∞·ªõc l·ªãch tr·∫£ g√≥p:</h6>
                <div id="preview-content"></div>
            </div>
        </div>
    </div>
</div>

        <!-- TH√îNG TIN D·ªäCH V·ª§ -->
        <div class="form-section">
          <div class="section-header">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            <h5>Th√¥ng tin d·ªãch v·ª•</h5>
          </div>

          <!-- Nh√£n hi·ªáu -->
          <div id="nhanhieu_form" class="service-block">
            <div class="service-header">
              <h6>D·ªãch v·ª• Nh√£n hi·ªáu</h6>
              <div class="header-buttons">
                <button type="button" class="btn-detail" onclick="window.location.href='{% url 'contract_search' %}'">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                  </svg>Xem danh s√°ch
                </button>
                <button type="button" class="btn-add" onclick="addForm('trademark')">‚ûï Th√™m nh√£n hi·ªáu</button>
              </div>
            </div>

            {{ trademark_formset.management_form }}

            <div class="service-content" id="trademark-formset">
              {% for form in trademark_formset %}
                <div class="formset-item">
                  {{ form.as_p }}

                  <!-- üî• TH√äM PH·∫¶N UPLOAD FILE -->
                  <div class="file-upload-section" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 5px; vertical-align: middle;">
                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                      </svg>üìé T√†i li·ªáu ƒë√≠nh k√®m (c√≥ th·ªÉ ch·ªçn nhi·ªÅu file)
                    </label>

                    <input type="file" name="trademark_files_{{ forloop.counter0 }}" multiple class="form-control file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="displaySelectedFiles(this)" style="padding: 10px; border: 1px solid #ced4da; border-radius: 6px;" />

                    <div class="selected-files-display" style="margin-top: 10px; font-size: 13px; color: #6c757d;"></div>

                    <small style="display: block; margin-top: 8px; color: #6c757d;">üí° Ch·∫•p nh·∫≠n: PDF, Word, H√¨nh ·∫£nh (JPG, PNG). C√≥ th·ªÉ ch·ªçn nhi·ªÅu file c√πng l√∫c.</small>
                  </div>

                  {{ form.DELETE }}
                  <button type="button" class="btn-remove" onclick="removeItem(this)">‚ùå X√≥a</button>
                </div>
              {% endfor %}
            </div>

            <div id="trademark-empty-form" style="display:none">
              <div class="formset-item">
                {{ trademark_formset.empty_form.as_p }}

                <!-- üî• TH√äM PH·∫¶N UPLOAD FILE CHO EMPTY FORM -->
                <div class="file-upload-section" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                  <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 5px; vertical-align: middle;">
                      <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>üìé T√†i li·ªáu ƒë√≠nh k√®m (c√≥ th·ªÉ ch·ªçn nhi·ªÅu file)
                  </label>

                  <input type="file" name="trademark_files___prefix__" multiple class="form-control file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="displaySelectedFiles(this)" style="padding: 10px; border: 1px solid #ced4da; border-radius: 6px;" />

                  <div class="selected-files-display" style="margin-top: 10px; font-size: 13px; color: #6c757d;"></div>

                  <small style="display: block; margin-top: 8px; color: #6c757d;">üí° Ch·∫•p nh·∫≠n: PDF, Word, H√¨nh ·∫£nh. C√≥ th·ªÉ ch·ªçn nhi·ªÅu file c√πng l√∫c.</small>
                </div>

                {{ trademark_formset.empty_form.DELETE }}
                <button type="button" class="btn-remove" onclick="removeItem(this)">‚ùå X√≥a</button>
              </div>
            </div>
          </div>

          <!-- B·∫£n quy·ªÅn - T∆Ø∆†NG T·ª∞ -->
          <div id="banquyen_form" class="service-block">
            <div class="service-header">
              <h6>D·ªãch v·ª• B·∫£n quy·ªÅn</h6>
              <div class="header-buttons">
                <button type="button" class="btn-detail" onclick="window.location.href='{% url 'contract_copyright_search' %}'">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                  </svg>Xem danh s√°ch
                </button>
                <button type="button" class="btn-add" onclick="addForm('copyright')">‚ûï Th√™m b·∫£n quy·ªÅn</button>
              </div>
            </div>

            {{ copyright_formset.management_form }}

            <div class="service-content" id="copyright-formset">
              {% for form in copyright_formset %}
                <div class="formset-item">
                  {{ form.as_p }}

                  <!-- üî• UPLOAD FILE CHO B·∫¢N QUY·ªÄN -->
                  <div class="file-upload-section" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">üìé T√†i li·ªáu ƒë√≠nh k√®m (c√≥ th·ªÉ ch·ªçn nhi·ªÅu file)</label>

                    <input type="file" name="copyright_files_{{ forloop.counter0 }}" multiple class="form-control file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="displaySelectedFiles(this)" style="padding: 10px; border: 1px solid #ced4da; border-radius: 6px;" />

                    <div class="selected-files-display" style="margin-top: 10px; font-size: 13px; color: #6c757d;"></div>
                  </div>

                  {{ form.DELETE }}
                  <button type="button" class="btn-remove" onclick="removeItem(this)">‚ùå X√≥a</button>
                </div>
              {% endfor %}
            </div>

            <div id="copyright-empty-form" style="display:none">
              <div class="formset-item">
                {{ copyright_formset.empty_form.as_p }}

                <div class="file-upload-section" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                  <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">üìé T√†i li·ªáu ƒë√≠nh k√®m</label>

                  <input type="file" name="copyright_files___prefix__" multiple class="form-control file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="displaySelectedFiles(this)" style="padding: 10px;" />

                  <div class="selected-files-display" style="margin-top: 10px;"></div>
                </div>

                {{ copyright_formset.empty_form.DELETE }}
                <button type="button" class="btn-remove" onclick="removeItem(this)">‚ùå X√≥a</button>
              </div>
            </div>
          </div>

          <!-- ƒêKKD -->
          <div id="dkkd_form" class="service-block">
            <div class="service-header">
              <div style="display: flex; align-items: center; gap: 10px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <h6>ƒêƒÉng k√Ω kinh doanh</h6>
              </div>
              <button type="button" class="btn-detail" onclick="window.location.href='{% url 'contract_business_search' %}'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>Xem danh s√°ch
              </button>
            </div>
            <div class="service-content">
              {{ business_form.as_p }}

              <!-- üî• UPLOAD FILE CHO ƒêKKD -->
              <div class="file-upload-section" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600;">üìé T√†i li·ªáu ƒë√≠nh k√®m</label>

                <input type="file" name="business_files" multiple class="form-control file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="displaySelectedFiles(this)" />

                <div class="selected-files-display" style="margin-top: 10px;"></div>
              </div>
            </div>
          </div>

          <!-- ƒê·∫ßu t∆∞ -->
          <div id="dautu_form" class="service-block">
            <div class="service-header">
              <div style="display: flex; align-items: center; gap: 10px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <h6>ƒê·∫ßu t∆∞</h6>
              </div>
              <button type="button" class="btn-detail" onclick="window.location.href='{% url 'contract_investment_search' %}'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>Xem danh s√°ch
              </button>
            </div>
            <div class="service-content">
              {{ investment_form.as_p }}

              <!-- üî• UPLOAD FILE CHO ƒê·∫¶U T∆Ø -->
              <div class="file-upload-section" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600;">üìé T√†i li·ªáu ƒë√≠nh k√®m</label>

                <input type="file" name="investment_files" multiple class="form-control file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="displaySelectedFiles(this)" />

                <div class="selected-files-display" style="margin-top: 10px;"></div>
              </div>
            </div>
          </div>

          <!-- Kh√°c -->
          <div id="khac_form" class="service-block">
            <div class="service-header">
              <div style="display: flex; align-items: center; gap: 10px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="16" x2="12" y2="12"></line>
                  <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <h6>D·ªãch v·ª• kh√°c</h6>
              </div>
              <button type="button" class="btn-detail" onclick="window.location.href='{% url 'contract_other_service_search' %}'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>Xem danh s√°ch
              </button>
            </div>
            <div class="service-content">{{ other_form.as_p }}</div>
          </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="form-actions">
          <button type="submit" class="btn-save">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>L∆∞u h·ª£p ƒë·ªìng
          </button>
          <button type="button" class="btn-cancel" id="cancelBtn" data-home-url="{% url 'home' %}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL X√ÅC NH·∫¨N R·ªúI TRANG -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <h4>X√°c nh·∫≠n r·ªùi trang</h4>
      </div>
      <div class="modal-body">
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën r·ªùi kh·ªèi trang n√†y?</p>
        <p class="modal-warning">‚ö†Ô∏è D·ªØ li·ªáu ch∆∞a l∆∞u s·∫Ω b·ªã m·∫•t!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="stayBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>Kh√¥ng, ·ªü l·∫°i
        </button>
        <button type="button" class="btn btn-danger" id="leaveBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>C√≥, r·ªùi trang
        </button>
      </div>
    </div>
  </div>

  <!-- jQuery (PH·∫¢I LOAD TR∆Ø·ªöC) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <!-- ‚úÖ CH·ªà LOAD FILE JS - KH√îNG C√ì INLINE SCRIPT N·ªÆA -->
  <script src="{% static 'js/add_contract.js' %}"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const paymentTypeSelect = document.getElementById('id_payment_type');
    const installmentSection = document.getElementById('installment-section');
    const contractValueInput = document.getElementById('id_contract_value');
    const numberOfInstallmentsInput = document.getElementById('id_number_of_installments');
    const intervalDaysInput = document.getElementById('id_installment_interval_days');
    const previewDiv = document.getElementById('installment-preview');
    const previewContent = document.getElementById('preview-content');

    // Hi·ªÉn th·ªã/·∫©n ph·∫ßn tr·∫£ g√≥p
    function toggleInstallmentSection() {
        if (paymentTypeSelect.value === 'installment') {
            installmentSection.style.display = 'block';
            updatePreview();
        } else {
            installmentSection.style.display = 'none';
            previewDiv.style.display = 'none';
        }
    }

    // C·∫≠p nh·∫≠t preview
    function updatePreview() {
        const contractValue = parseFloat(contractValueInput.value) || 0;
        const numInstallments = parseInt(numberOfInstallmentsInput.value) || 1;
        const intervalDays = parseInt(intervalDaysInput.value) || 30;

        if (contractValue > 0 && numInstallments > 0) {
            const amountPerInstallment = contractValue / numInstallments;
            const today = new Date();

            let html = '<table class="table table-sm table-bordered"><thead><tr><th>ƒê·ª£t</th><th>S·ªë ti·ªÅn</th><th>Ng√†y ƒë·∫øn h·∫°n (d·ª± ki·∫øn)</th></tr></thead><tbody>';

            for (let i = 0; i < numInstallments; i++) {
                const dueDate = new Date(today);
                dueDate.setDate(dueDate.getDate() + (intervalDays * i));

                html += `<tr>
                    <td>ƒê·ª£t ${i + 1}/${numInstallments}</td>
                    <td class="text-end">${amountPerInstallment.toLocaleString('vi-VN')} VNƒê</td>
                    <td class="text-center">${dueDate.toLocaleDateString('vi-VN')}</td>
                </tr>`;
            }

            html += '</tbody></table>';
            previewContent.innerHTML = html;
            previewDiv.style.display = 'block';
        } else {
            previewDiv.style.display = 'none';
        }
    }

    // Event listeners
    paymentTypeSelect.addEventListener('change', toggleInstallmentSection);
    contractValueInput.addEventListener('input', updatePreview);
    numberOfInstallmentsInput.addEventListener('input', updatePreview);
    intervalDaysInput.addEventListener('input', updatePreview);

    // Kh·ªüi t·∫°o
    toggleInstallmentSection();
});
</script>
  <script>
    // ‚úÖ Logic hi·ªÉn th·ªã tr∆∞·ªùng ng√†y thanh to√°n
    $(document).ready(function () {
      const paymentTypeField = $('#id_payment_type')
      const paymentDateField = $('#payment_date_field')
    
      // H√†m ki·ªÉm tra v√† hi·ªÉn th·ªã/·∫©n tr∆∞·ªùng ng√†y thanh to√°n
      function togglePaymentDate() {
        if (paymentTypeField.val() === 'full') {
          paymentDateField.show()
        } else {
          paymentDateField.hide()
          $('#id_payment_date').val('') // X√≥a gi√° tr·ªã khi ·∫©n
        }
      }
    
      // Ch·∫°y l·∫ßn ƒë·∫ßu khi load trang
      togglePaymentDate()
    
      // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi
      paymentTypeField.on('change', togglePaymentDate)
    })
  </script>

  <style>
    /* Payment date field styling */
    #payment_date_field {
      margin-top: 20px;
      padding: 15px;
      background-color: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 8px;
    }
    
    #payment_date_field label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #166534;
    }
    
    #payment_date_field input {
      width: 100%;
      padding: 10px;
      border: 1px solid #86efac;
      border-radius: 6px;
      font-size: 14px;
    }
    
    #payment_date_field input:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }
    
    #payment_date_field .form-text {
      margin-top: 6px;
      font-size: 13px;
      color: #16a34a;
    }
    
    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.2s ease-in-out;
    }
    
    .modal-overlay.show {
      display: flex !important;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 0;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.3s ease-out;
    }
    
    .modal-header {
      padding: 30px 30px 20px;
      text-align: center;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .modal-header svg {
      margin-bottom: 15px;
    }
    
    .modal-header h4 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
      color: #1f2937;
    }
    
    .modal-body {
      padding: 25px 30px;
      text-align: center;
    }
    
    .modal-body p {
      margin: 0 0 10px 0;
      font-size: 15px;
      color: #4b5563;
      line-height: 1.6;
    }
    
    .modal-warning {
      color: #f59e0b !important;
      font-weight: 600;
      font-size: 14px !important;
      margin-top: 15px !important;
    }
    
    .modal-footer {
      padding: 20px 30px 30px;
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    .modal-footer .btn {
      padding: 10px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .btn-secondary {
      background-color: #e5e7eb;
      color: #374151;
    }
    
    .btn-secondary:hover {
      background-color: #d1d5db;
      transform: translateY(-1px);
    }
    
    .btn-danger {
      background-color: #ef4444;
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #dc2626;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    
    /* Styles cho n√∫t "Xem danh s√°ch" */
    .btn-detail {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25);
    }
    
    .btn-detail:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .btn-detail:active {
      transform: translateY(0);
    }
    
    /* C·∫≠p nh·∫≠t service-header ƒë·ªÉ ch·ª©a nhi·ªÅu n√∫t */
    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .service-header h6 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
    }
    
    .header-buttons {
      display: flex;
      gap: 10px;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>
{% endblock %}
